# æ—¥å¿—ä¸­æ–‡åŒ–å®Œæˆè¯´æ˜

## âœ… ä¿®æ”¹å®Œæˆ

æ‰€æœ‰è‹±æ–‡æ—¥å¿—å·²å…¨éƒ¨æ”¹ä¸ºä¸­æ–‡ï¼ŒåŒ…æ‹¬ESP32å›ºä»¶å’ŒSpring Bootåç«¯ã€‚

---

## ğŸ“ ESP32å›ºä»¶æ—¥å¿—ä¿®æ”¹ (CameraWebServer.ino)

### 1. å¯åŠ¨å’Œåˆå§‹åŒ–

**ä¿®æ”¹å‰**:
```
ESP32-CAM MQTT IoT Device Starting...
Configuration loaded:
WiFi SSID: 2702
Camera initialized successfully
LED PWM initialized
WiFi connected
IP Address: 192.168.124.100
Stream available at: http://192.168.124.100/stream
ESP32-CAM Ready!
```

**ä¿®æ”¹å**:
```
ESP32-CAM MQTT ç‰©è”ç½‘è®¾å¤‡å¯åŠ¨ä¸­...
é…ç½®å·²åŠ è½½:
WiFiåç§°: 2702
æ‘„åƒå¤´åˆå§‹åŒ–æˆåŠŸ
LED PWMåˆå§‹åŒ–å®Œæˆ
WiFiè¿æ¥æˆåŠŸ
IPåœ°å€: 192.168.124.100
è§†é¢‘æµåœ°å€: http://192.168.124.100/stream
ESP32-CAM å°±ç»ªï¼
```

### 2. MQTTè¿æ¥

**ä¿®æ”¹å‰**:
```
Connecting to MQTT...connected
Subscribed to: cam/esp32cam/cmd
MQTT message received [cam/esp32cam/cmd]: {"id":5741231234,"op":"capture"}
Processing: id=5741231234, op=capture
```

**ä¿®æ”¹å**:
```
æ­£åœ¨è¿æ¥MQTT...è¿æ¥æˆåŠŸ
å·²è®¢é˜…: cam/esp32cam/cmd
MQTTæ¶ˆæ¯ [cam/esp32cam/cmd]: {"id":5741231234,"op":"capture"}
å¤„ç†æŒ‡ä»¤: id=5741231234, op=capture
```

### 3. æ‹ç…§ä¸Šä¼ 

**ä¿®æ”¹å‰**:
```
Starting capture and upload...
Command ID received: 5741231234
Captured image: 152536 bytes
Starting image upload...
Filename: esp32cam_5741231234.jpg (cmdId: 5741231234)
Image size: 152536 bytes
Total upload size: 152836 bytes
Sending POST request...
HTTP Response code: 200
Response: {"code":0,"message":"ä¸Šä¼ æˆåŠŸ"...}
âœ“ Upload SUCCESS!
Upload process completed
```

**ä¿®æ”¹å**:
```
å¼€å§‹æ‹ç…§ä¸Šä¼ ...
æ”¶åˆ°æŒ‡ä»¤ID: 5741231234
å·²æ‹ç…§ç‰‡: 152536 å­—èŠ‚
å¼€å§‹ä¸Šä¼ å›¾ç‰‡...
æ–‡ä»¶å: esp32cam_5741231234.jpg (cmdId: 5741231234)
å›¾ç‰‡å¤§å°: 152536 å­—èŠ‚
æ€»ä¸Šä¼ å¤§å°: 152836 å­—èŠ‚
å‘é€POSTè¯·æ±‚...
HTTPå“åº”ç : 200
å“åº”: {"code":0,"message":"ä¸Šä¼ æˆåŠŸ"...}
âœ“ ä¸Šä¼ æˆåŠŸï¼
ä¸Šä¼ å®Œæˆ
```

### 4. é…ç½®ç®¡ç†

**ä¿®æ”¹å‰**:
```
WiFi config saved to Flash
MQTT config saved to Flash
Upload URL saved to Flash
Config reset to defaults
Published config: {"id":123,"ok":true...}
```

**ä¿®æ”¹å**:
```
WiFié…ç½®å·²ä¿å­˜åˆ°Flash
MQTTé…ç½®å·²ä¿å­˜åˆ°Flash
ä¸Šä¼ URLå·²ä¿å­˜åˆ°Flash
é…ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼
å·²å‘å¸ƒé…ç½®: {"id":123,"ok":true...}
```

### 5. LEDå’Œæ‘„åƒå¤´æ§åˆ¶

**ä¿®æ”¹å‰**:
```
LED ON
LED brightness set to 128
Camera param brightness set to 1
Published status: {"clientId":"esp32cam"...}
Published result: {"id":123,"ok":true...}
```

**ä¿®æ”¹å**:
```
LED å¼€å¯
LEDäº®åº¦è®¾ç½®ä¸º 128
æ‘„åƒå¤´å‚æ•° brightness è®¾ç½®ä¸º 1
å·²å‘å¸ƒçŠ¶æ€: {"clientId":"esp32cam"...}
å·²å‘å¸ƒç»“æœ: {"id":123,"ok":true...}
```

### 6. é”™è¯¯ä¿¡æ¯

**ä¿®æ”¹å‰**:
```
Camera capture failed
WiFi not connected, upload failed
âœ— HTTP begin failed
âœ— Memory allocation failed
âœ— Upload FAILED with code 500
âœ— HTTP error: connection refused
JSON parse failed: invalid input
Invalid command format
WiFi connection failed!
```

**ä¿®æ”¹å**:
```
æ‘„åƒå¤´æ‹ç…§å¤±è´¥
WiFiæœªè¿æ¥ï¼Œä¸Šä¼ å¤±è´¥
âœ— HTTPåˆå§‹åŒ–å¤±è´¥
âœ— å†…å­˜åˆ†é…å¤±è´¥
âœ— ä¸Šä¼ å¤±è´¥ï¼Œé”™è¯¯ç  500
âœ— HTTPé”™è¯¯: connection refused
JSONè§£æå¤±è´¥: invalid input
æ— æ•ˆçš„æŒ‡ä»¤æ ¼å¼
WiFiè¿æ¥å¤±è´¥ï¼
```

---

## ğŸ¯ Spring Bootåç«¯æ—¥å¿— (å·²æ˜¯ä¸­æ–‡)

åç«¯æ—¥å¿—ä»ä¸€å¼€å§‹å°±æ˜¯ä¸­æ–‡ï¼ŒåŒ…æ‹¬ï¼š

```java
log.info("MQTTæ”¶åˆ°æ¶ˆæ¯ topic={}, payload={}", topic, json);
log.info("æŒ‡ä»¤ {} æ‰§è¡Œå®Œæˆ, ç»“æœ: ok={}, info={}", r.getId(), r.isOk(), r.getInfo());
log.info("è®¾å¤‡çŠ¶æ€æ›´æ–°: clientId={}, uptime={}s, freeHeap={}, rssi={}", ...);
log.info("å‘é€æ‹ç…§æŒ‡ä»¤: clientId={}, cmdId={}", clientId, id);
log.info("å‘é€LEDæ§åˆ¶æŒ‡ä»¤: clientId={}, cmdId={}, value={}", clientId, id, value);
log.info("å‘é€LEDäº®åº¦æŒ‡ä»¤: clientId={}, cmdId={}, brightness={}", clientId, id, value);
log.info("å‘é€æ‘„åƒå¤´å‚æ•°æŒ‡ä»¤: clientId={}, cmdId={}, param={}, value={}", ...);
```

---

## ğŸ“Š å®Œæ•´çš„ä¸­æ–‡æ—¥å¿—ç¤ºä¾‹

### åœºæ™¯: è¿œç¨‹æ‹ç…§å®Œæ•´æµç¨‹

```
ã€åç«¯æ—¥å¿—ã€‘
å‘é€æ‹ç…§æŒ‡ä»¤: clientId=esp32cam, cmdId=5741231234

ã€ESP32æ—¥å¿—ã€‘
MQTTæ¶ˆæ¯ [cam/esp32cam/cmd]: {"id":5741231234,"op":"capture","val":0}
å¤„ç†æŒ‡ä»¤: id=5741231234, op=capture
å¼€å§‹æ‹ç…§ä¸Šä¼ ...
æ”¶åˆ°æŒ‡ä»¤ID: 5741231234
å·²æ‹ç…§ç‰‡: 152536 å­—èŠ‚
å¼€å§‹ä¸Šä¼ å›¾ç‰‡...
æ–‡ä»¶å: esp32cam_5741231234.jpg (cmdId: 5741231234)
å›¾ç‰‡å¤§å°: 152536 å­—èŠ‚
æ€»ä¸Šä¼ å¤§å°: 152836 å­—èŠ‚
å‘é€POSTè¯·æ±‚...
HTTPå“åº”ç : 200
å“åº”: {"code":0,"message":"ä¸Šä¼ æˆåŠŸ","data":{"fileName":"esp32cam_5741231234.jpg","fileSize":"152536"},"timestamp":"1733574123456"}
âœ“ ä¸Šä¼ æˆåŠŸï¼
ä¸Šä¼ å®Œæˆ
å·²å‘å¸ƒç»“æœ: {"id":5741231234,"ok":true,"info":"Upload success"}

ã€åç«¯æ—¥å¿—ã€‘
MQTTæ”¶åˆ°æ¶ˆæ¯ topic=cam/esp32cam/result, payload={"id":5741231234,"ok":true,"info":"Upload success"}
æŒ‡ä»¤ 5741231234 æ‰§è¡Œå®Œæˆ, ç»“æœ: ok=true, info=Upload success
å›¾ç‰‡ä¸Šä¼ æˆåŠŸ: esp32cam_5741231234.jpg, å¤§å°: 152536 bytes
```

---

## ğŸ¨ æ—¥å¿—æ ¼å¼ç‰¹ç‚¹

### ESP32æ—¥å¿—ç‰¹è‰²
- âœ… **ç¬¦å·ä½¿ç”¨**: âœ“ (æˆåŠŸ) âœ— (å¤±è´¥)
- ğŸ“ **å•ä½æ˜¾ç¤º**: "å­—èŠ‚" è€Œé "bytes"
- ğŸ”§ **åŠ¨ä½œæè¿°**: "å¼€å§‹..."ã€"å·²..."ã€"æ­£åœ¨..."
- âš ï¸ **é”™è¯¯æç¤º**: æ¸…æ™°çš„ä¸­æ–‡é”™è¯¯è¯´æ˜

### åç«¯æ—¥å¿—ç‰¹è‰²
- ğŸ“Š **ç»“æ„åŒ–**: Key=Valueæ ¼å¼
- ğŸ¯ **å…³é”®ä¿¡æ¯**: clientId, cmdId, çŠ¶æ€å€¼
- â±ï¸ **æ—¶åºä¿¡æ¯**: "å‘é€"ã€"æ”¶åˆ°"ã€"æ‰§è¡Œå®Œæˆ"

---

## âœ… æ€»ç»“

**ä¿®æ”¹å†…å®¹**:
- ESP32å›ºä»¶: ~50å¤„è‹±æ–‡æ—¥å¿— â†’ ä¸­æ–‡
- Spring Bootåç«¯: å·²æ˜¯ä¸­æ–‡ï¼Œæ— éœ€ä¿®æ”¹

**ä¼˜åŠ¿**:
- ğŸ‡¨ğŸ‡³ **æ˜“è¯»æ€§**: ä¸­æ–‡æ¯è¯­è€…ç›´æ¥ç†è§£
- ğŸ› **è°ƒè¯•å‹å¥½**: å¿«é€Ÿå®šä½é—®é¢˜
- ğŸ“š **å­¦ä¹ å‹å¥½**: éè‹±è¯­ç”¨æˆ·æ›´å®¹æ˜“å­¦ä¹ 
- ğŸ” **è¿ç»´ä¾¿åˆ©**: ç°åœºé—®é¢˜æ’æŸ¥æ›´é«˜æ•ˆ

ç°åœ¨æ•´ä¸ªç³»ç»Ÿçš„æ—¥å¿—è¾“å‡ºå…¨éƒ¨æ˜¯ä¸­æ–‡ï¼ä¾¿äºå›½å†…å¼€å‘è€…ä½¿ç”¨å’Œç»´æŠ¤ï¼
