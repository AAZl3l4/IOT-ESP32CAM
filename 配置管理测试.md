# ESP32-CAM é…ç½®åŠ¨æ€ç®¡ç†åŠŸèƒ½æµ‹è¯•æŒ‡å—

## ğŸ¯ åŠŸèƒ½è¯´æ˜

ESP32-CAMç°åœ¨æ”¯æŒé€šè¿‡åç«¯APIåŠ¨æ€ä¿®æ”¹é…ç½®ï¼Œé…ç½®æ°¸ä¹…ä¿å­˜åˆ°Flashä¸­ï¼Œé‡å¯ä¸ä¸¢å¤±ã€‚

### å¯é…ç½®é¡¹

1. **WiFié…ç½®** - ä¿®æ”¹åè‡ªåŠ¨é‡å¯
2. **MQTTé…ç½®** - ä¿®æ”¹åè‡ªåŠ¨é‡å¯  
3. **ä¸Šä¼ URL** - ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯

---

## ğŸ“¡ é…ç½®ç®¡ç†API

### 1. è®¾ç½®WiFié…ç½®

```bash
curl -X POST "http://192.168.124.68:8080/mqtt/config/wifi/esp32cam?ssid=NewWiFi&password=NewPassword123"
```

**å“åº”**:
```json
{
  "code": 0,
  "msg": "WiFié…ç½®å·²ä¿å­˜ï¼Œè®¾å¤‡å°†é‡å¯",
  "data": "cmd queued 1733570000000"
}
```

**ESP32è¡Œä¸º**: ä¿å­˜é…ç½®åˆ°Flash â†’ è‡ªåŠ¨é‡å¯ â†’ è¿æ¥æ–°WiFi

### 2. è®¾ç½®MQTTé…ç½®

```bash
curl -X POST "http://192.168.124.68:8080/mqtt/config/mqtt/esp32cam?server=mqtt.example.com&port=1883&mqttClientId=esp32cam002"
```

**å‚æ•°è¯´æ˜**:
- `server`: MQTTæœåŠ¡å™¨åœ°å€ï¼ˆå¿…å¡«ï¼‰
- `port`: MQTTç«¯å£ï¼ˆé»˜è®¤1883ï¼‰
- `mqttClientId`: MQTTå®¢æˆ·ç«¯IDï¼ˆå¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨åŸIDï¼‰

**ESP32è¡Œä¸º**: ä¿å­˜é…ç½® â†’ é‡å¯ â†’ è¿æ¥æ–°MQTTæœåŠ¡å™¨

### 3. è®¾ç½®ä¸Šä¼ URL

```bash
curl -X POST "http://192.168.124.68:8080/mqtt/config/upload-url/esp32cam?url=http://192.168.1.200:8080/mqtt/cam/upload"
```

**URLéªŒè¯**: å¿…é¡»ä»¥`http://`æˆ–`https://`å¼€å¤´

**ESP32è¡Œä¸º**: ä¿å­˜é…ç½® â†’ ç«‹å³ç”Ÿæ•ˆï¼ˆæ— éœ€é‡å¯ï¼‰

### 4. æŸ¥è¯¢å½“å‰é…ç½®

```bash
curl http://192.168.124.68:8080/mqtt/config/esp32cam
```

**ESP32å“åº”** (é€šè¿‡MQTT `result` topic):
```json
{
  "id": 1733570000005,
  "ok": true,
  "config": {
    "wifi_ssid": "2702",
    "mqtt_server": "broker.emqx.io",
    "mqtt_port": 1883,
    "mqtt_client": "esp32cam",
    "upload_url": "http://192.168.124.68:8080/mqtt/cam/upload"
  }
}
```

### 5. æ¢å¤é»˜è®¤é…ç½®

```bash
curl -X POST http://192.168.124.68:8080/mqtt/config/reset/esp32cam
```

**ESP32è¡Œä¸º**: æ¸…é™¤Flashé…ç½® â†’ é‡å¯ â†’ ä½¿ç”¨é»˜è®¤å€¼

---

## ğŸ§ª å®Œæ•´æµ‹è¯•æµç¨‹

### æ­¥éª¤1: ä¸Šä¼ æ–°å›ºä»¶

1. æ‰“å¼€Arduino IDE
2. ä¸Šä¼  `CameraWebServer.ino`
3. æ‰“å¼€ä¸²å£ç›‘è§†å™¨æŸ¥çœ‹å¯åŠ¨ä¿¡æ¯

### æ­¥éª¤2: æŸ¥çœ‹åˆå§‹é…ç½®

```bash
curl http://192.168.124.68:8080/mqtt/config/esp32cam
```

æŸ¥çœ‹ESP32ä¸²å£æˆ–åç«¯MQTTæ—¥å¿—ç¡®è®¤é…ç½®å†…å®¹ã€‚

### æ­¥éª¤3: æµ‹è¯•ä¸Šä¼ URLä¿®æ”¹

```bash
curl -X POST "http://192.168.124.68:8080/mqtt/config/upload-url/esp32cam?url=http://192.168.124.68:8080/mqtt/cam/upload"
```

**æ£€æŸ¥ESP32ä¸²å£**: åº”æ˜¾ç¤º
```
Upload URL saved to Flash
```

**ç«‹å³æµ‹è¯•æ‹ç…§**: 
```bash
curl -X POST http://192.168.124.68:8080/mqtt/capture/esp32cam
```

åº”è¯¥èƒ½æ­£å¸¸ä¸Šä¼ ï¼ˆæ— éœ€é‡å¯ï¼‰ã€‚

### æ­¥éª¤4: æµ‹è¯•WiFié…ç½®ï¼ˆæ…é‡ï¼‰

> [!CAUTION]
> ä¿®æ”¹WiFié…ç½®ä¼šå¯¼è‡´ESP32é‡å¯å¹¶è¿æ¥æ–°ç½‘ç»œï¼Œè¯·ç¡®ä¿æ–°WiFiå¯ç”¨ï¼

```bash
curl -X POST "http://192.168.124.68:8080/mqtt/config/wifi/esp32cam?ssid=TestWiFi&password=TestPass123"
```

**ESP32ä¸²å£è¾“å‡º**:
```
WiFi config saved to Flash
Published result: {"id":xxx,"ok":true,"info":"WiFi config saved, restarting..."}
ESP32é‡å¯ä¸­...
WiFi connecting to: TestWiFi
```

### æ­¥éª¤5: æµ‹è¯•æ¢å¤é»˜è®¤é…ç½®

å¦‚æœæ­¥éª¤4é…ç½®é”™è¯¯å¯¼è‡´æ— æ³•è¿æ¥ï¼Œé€šè¿‡ä¸²å£å·¥å…·æˆ–é‡æ–°çƒ§å½•å›ºä»¶æ¢å¤é»˜è®¤é…ç½®ï¼š

æ–¹æ³•1 - é€šè¿‡APIï¼ˆéœ€è¦ESP32åœ¨çº¿ï¼‰:
```bash
curl -X POST http://192.168.124.68:8080/mqtt/config/reset/esp32cam
```

æ–¹æ³•2 - é‡æ–°çƒ§å½•å›ºä»¶ï¼ˆFlashä¼šè¢«æ¸…é™¤ï¼Œè‡ªåŠ¨æ¢å¤é»˜è®¤å€¼ï¼‰

---

## ğŸ” è°ƒè¯•è¦ç‚¹

### ESP32ä¸²å£å…³é”®æ—¥å¿—

**å¯åŠ¨æ—¶**:
```
Configuration loaded:
WiFi SSID: 2702
MQTT Server: broker.emqx.io:1883
MQTT Client: esp32cam
Upload URL: http://192.168.124.68:8080/mqtt/cam/upload
```

**é…ç½®ä¿å­˜æ—¶**:
```
WiFi config saved to Flash
MQTT config saved to Flash
Upload URL saved to Flash
Config reset to defaults
```

**URLéªŒè¯å¤±è´¥**:
```
Published result: {"id":xxx,"ok":false,"info":"Invalid URL format"}
```

### åç«¯æ—¥å¿—

```
å‘é€WiFié…ç½®æŒ‡ä»¤: clientId=esp32cam, cmdId=1733570000000
MQTTæ”¶åˆ°æ¶ˆæ¯ topic=cam/esp32cam/result, payload={"id":...,"ok":true,"info":"..."}
```

---

## ğŸ“‹ é…ç½®æŒä¹…åŒ–åŸç†

### ESP32 Flashå­˜å‚¨

ä½¿ç”¨ESP32çš„**Preferencesåº“**ï¼ˆåŸºäºNVSï¼‰:

| Key | ç±»å‹ | é»˜è®¤å€¼ |
|-----|------|--------|
| `wifi_ssid` | String | `2702` |
| `wifi_pass` | String | `18063328637` |
| `mqtt_server` | String | `broker.emqx.io` |
| `mqtt_port` | int | `1883` |
| `mqtt_client` | String | `esp32cam` |
| `upload_url` | String | `http://192.168.124.68:8080/mqtt/cam/upload` |

**å­˜å‚¨ä½ç½®**: ESP32ç‰‡ä¸ŠFlashçš„NVSåˆ†åŒº  
**ç‰¹ç‚¹**: æ–­ç”µä¸ä¸¢å¤±ï¼Œé‡å¯åè‡ªåŠ¨åŠ è½½

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **WiFi/MQTTé…ç½®ä¿®æ”¹ä¼šå¯¼è‡´é‡å¯** - çº¦éœ€10-30ç§’é‡æ–°ä¸Šçº¿
2. **ä¸Šä¼ URLç«‹å³ç”Ÿæ•ˆ** - æ— éœ€é‡å¯
3. **URLæ ¼å¼éªŒè¯** - å¿…é¡»ä»¥http://æˆ–https://å¼€å¤´
4. **é…ç½®å¤‡ä»½** - å»ºè®®è®°å½•åŸé…ç½®ï¼Œæ–¹ä¾¿æ¢å¤
5. **ç½‘ç»œåˆ‡æ¢** - ä¿®æ”¹WiFiåç¡®ä¿æ–°ç½‘ç»œå¯ç”¨ï¼Œå¦åˆ™è®¾å¤‡å°†æ— æ³•è¿æ¥

---

## âœ… æˆåŠŸæ ‡å¿—

- **é…ç½®ä¿å­˜**: ESP32ä¸²å£æ˜¾ç¤º"xxx config saved to Flash"
- **è‡ªåŠ¨é‡å¯**: WiFi/MQTTä¿®æ”¹åçœ‹åˆ°"ESP32-CAM MQTT IoT Device Starting..."
- **é…ç½®åŠ è½½**: é‡å¯åä¸²å£æ˜¾ç¤º"Configuration loaded"å’Œæ–°é…ç½®å€¼
- **åŠŸèƒ½æ­£å¸¸**: é…ç½®ä¿®æ”¹åæ‹ç…§ã€MQTTé€šä¿¡ç­‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

**æµ‹è¯•å®Œæˆåï¼Œæ‰€æœ‰é…ç½®æ°¸ä¹…ä¿å­˜ï¼Œå³ä½¿æ–­ç”µé‡å¯ä¹Ÿä¼šä½¿ç”¨æ–°é…ç½®ï¼**
